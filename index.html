<!DOCTYPE html>
<html lang="en" id="oranda" class="axo">
  <head>
    <title>kdl-script</title>
    
    
      <link rel="icon" href="/kdl-script/favicon.ico" />
    
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
      <meta name="description" content="execute kdl documents!" />
      <meta property="og:description" content="execute kdl documents!" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="kdl-script" />
    
    
    
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()" />
    <link rel="stylesheet" href="/kdl-script/oranda-v0.6.1.css" />
    
    
  </head>
  <body>
    <div class="container">
      <div class="page-body">
        
          <div class="repo_banner">
            <a href="https://github.com/Gankra/kdl-script">
              <div class="github-icon" aria-hidden="true"></div>
              Check out our GitHub!
            </a>
          </div>
        

        <main>
          <header>
            
            <h1 class="title">kdl-script</h1>
            
  <nav class="nav">
    <ul>
      <li><a href="/kdl-script/">Home</a></li>

      

      
        <li><a href="/kdl-script/artifacts/">Install</a></li>
      

      

      

      
        <li><a href="/kdl-script/changelog/">Changelog</a></li>
      
    </ul>
  </nav>

          </header>

          

    



<div class="artifacts" data-tag="v0.3.0">
  <div class="artifact-header target">
    <h4>Install v0.3.0</h4>
    
      <div><small class="published-date">Published on 2024-06-25 16:33:20</small></div>
    

    <ul class="arches">
      
        <li class="arch hidden" data-arch="aarch64-apple-darwin">
          
            <ul class="tabs">
              
                
                
                <li class="install-tab" data-id="3" data-triple="aarch64-apple-darwin">
                  shell

                  
                </li>
              
                
                
                <li class="install-tab" data-id="0" data-triple="aarch64-apple-darwin">
                  cargo

                  
                </li>
              
                
                
                <li class="install-tab" data-id="1" data-triple="aarch64-apple-darwin">
                  tarball

                  
                </li>
              
            </ul>
          

          <ul class="contents">
            
              
              <li data-id="3" data-triple="aarch64-apple-darwin" class="install-content">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">curl</span><span style="color:#89ddff;"> --</span><span style="color:#f78c6c;">proto </span><span style="color:#89ddff;">&#39;</span><span style="color:#c3e88d;">=https</span><span style="color:#89ddff;">&#39; --</span><span style="color:#f78c6c;">tlsv1</span><span style="color:#82aaff;">.2</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">LsSf</span><span style="color:#82aaff;"> https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-installer.sh </span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">sh</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="curl --proto '=https' --tlsv1.2 -LsSf https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-installer.sh | sh">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
    
    
      
    
    <a class="button primary" href="/kdl-script/kdl-script-installer.sh.txt">Source</a>
  
</div>
                

                
              </li>
            
              
              <li data-id="0" data-triple="aarch64-apple-darwin" class="install-content hidden">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">cargo install kdl-script</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="cargo install kdl-script">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
</div>
                

                
              </li>
            
              
              <li data-id="1" data-triple="aarch64-apple-darwin" class="install-content hidden">
                

                
                  
                  <div class="download-wrapper">
                    <a href="https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-aarch64-apple-darwin.tar.xz">
                      <button class="button primary">
                        <span>Download</span>
                        <span class="button-subtitle">kdl-script-aarch64-apple-darwin.tar.xz</span>
                      </button>
                    </a>
                  </div>
                
              </li>
            
          </ul>
        </li>
      
        <li class="arch hidden" data-arch="x86_64-apple-darwin">
          
            <ul class="tabs">
              
                
                
                <li class="install-tab" data-id="3" data-triple="x86_64-apple-darwin">
                  shell

                  
                </li>
              
                
                
                <li class="install-tab" data-id="0" data-triple="x86_64-apple-darwin">
                  cargo

                  
                </li>
              
                
                
                <li class="install-tab" data-id="4" data-triple="x86_64-apple-darwin">
                  tarball

                  
                </li>
              
            </ul>
          

          <ul class="contents">
            
              
              <li data-id="3" data-triple="x86_64-apple-darwin" class="install-content">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">curl</span><span style="color:#89ddff;"> --</span><span style="color:#f78c6c;">proto </span><span style="color:#89ddff;">&#39;</span><span style="color:#c3e88d;">=https</span><span style="color:#89ddff;">&#39; --</span><span style="color:#f78c6c;">tlsv1</span><span style="color:#82aaff;">.2</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">LsSf</span><span style="color:#82aaff;"> https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-installer.sh </span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">sh</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="curl --proto '=https' --tlsv1.2 -LsSf https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-installer.sh | sh">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
    
    
      
    
    <a class="button primary" href="/kdl-script/kdl-script-installer.sh.txt">Source</a>
  
</div>
                

                
              </li>
            
              
              <li data-id="0" data-triple="x86_64-apple-darwin" class="install-content hidden">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">cargo install kdl-script</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="cargo install kdl-script">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
</div>
                

                
              </li>
            
              
              <li data-id="4" data-triple="x86_64-apple-darwin" class="install-content hidden">
                

                
                  
                  <div class="download-wrapper">
                    <a href="https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-x86_64-apple-darwin.tar.xz">
                      <button class="button primary">
                        <span>Download</span>
                        <span class="button-subtitle">kdl-script-x86_64-apple-darwin.tar.xz</span>
                      </button>
                    </a>
                  </div>
                
              </li>
            
          </ul>
        </li>
      
        <li class="arch hidden" data-arch="x86_64-pc-windows-msvc">
          
            <ul class="tabs">
              
                
                
                <li class="install-tab" data-id="2" data-triple="x86_64-pc-windows-msvc">
                  powershell

                  
                </li>
              
                
                
                <li class="install-tab" data-id="0" data-triple="x86_64-pc-windows-msvc">
                  cargo

                  
                </li>
              
                
                
                <li class="install-tab" data-id="5" data-triple="x86_64-pc-windows-msvc">
                  zip

                  
                </li>
              
            </ul>
          

          <ul class="contents">
            
              
              <li data-id="2" data-triple="x86_64-pc-windows-msvc" class="install-content">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">powershell</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">c </span><span style="color:#89ddff;">&quot;</span><span style="color:#c3e88d;">irm https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-installer.ps1 | iex</span><span style="color:#89ddff;">&quot;</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="powershell -c "irm https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-installer.ps1 | iex"">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
    
    
      
    
    <a class="button primary" href="/kdl-script/kdl-script-installer.ps1.txt">Source</a>
  
</div>
                

                
              </li>
            
              
              <li data-id="0" data-triple="x86_64-pc-windows-msvc" class="install-content hidden">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">cargo install kdl-script</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="cargo install kdl-script">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
</div>
                

                
              </li>
            
              
              <li data-id="5" data-triple="x86_64-pc-windows-msvc" class="install-content hidden">
                

                
                  
                  <div class="download-wrapper">
                    <a href="https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-x86_64-pc-windows-msvc.zip">
                      <button class="button primary">
                        <span>Download</span>
                        <span class="button-subtitle">kdl-script-x86_64-pc-windows-msvc.zip</span>
                      </button>
                    </a>
                  </div>
                
              </li>
            
          </ul>
        </li>
      
        <li class="arch hidden" data-arch="x86_64-unknown-linux-gnu">
          
            <ul class="tabs">
              
                
                
                <li class="install-tab" data-id="3" data-triple="x86_64-unknown-linux-gnu">
                  shell

                  
                </li>
              
                
                
                <li class="install-tab" data-id="0" data-triple="x86_64-unknown-linux-gnu">
                  cargo

                  
                </li>
              
                
                
                <li class="install-tab" data-id="6" data-triple="x86_64-unknown-linux-gnu">
                  tarball

                  
                </li>
              
            </ul>
          

          <ul class="contents">
            
              
              <li data-id="3" data-triple="x86_64-unknown-linux-gnu" class="install-content">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">curl</span><span style="color:#89ddff;"> --</span><span style="color:#f78c6c;">proto </span><span style="color:#89ddff;">&#39;</span><span style="color:#c3e88d;">=https</span><span style="color:#89ddff;">&#39; --</span><span style="color:#f78c6c;">tlsv1</span><span style="color:#82aaff;">.2</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">LsSf</span><span style="color:#82aaff;"> https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-installer.sh </span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">sh</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="curl --proto '=https' --tlsv1.2 -LsSf https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-installer.sh | sh">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
    
    
      
    
    <a class="button primary" href="/kdl-script/kdl-script-installer.sh.txt">Source</a>
  
</div>
                

                
              </li>
            
              
              <li data-id="0" data-triple="x86_64-unknown-linux-gnu" class="install-content hidden">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">cargo install kdl-script</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="cargo install kdl-script">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
</div>
                

                
              </li>
            
              
              <li data-id="6" data-triple="x86_64-unknown-linux-gnu" class="install-content hidden">
                

                
                  
                  <div class="download-wrapper">
                    <a href="https://gankra.artifacts.axodotdev.host/kdl-script/v0.3.0/kdl-script-x86_64-unknown-linux-gnu.tar.xz">
                      <button class="button primary">
                        <span>Download</span>
                        <span class="button-subtitle">kdl-script-x86_64-unknown-linux-gnu.tar.xz</span>
                      </button>
                    </a>
                  </div>
                
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>

  
    <div class="no-autodetect hidden">
      <span class="no-autodetect-details">We weren't able to detect your OS.</span>
    </div>
    <noscript>
      <a href="/kdl-script/artifacts/">View all installation options</a>
    </noscript>
  
  <div class="mac-switch hidden">This project doesn't offer Apple Silicon downloads, but you can run Intel macOS binaries via Rosetta 2.</div>

  
  
  <div class="bottom-options ">
    <a href="/kdl-script/artifacts/" class="backup-download primary">View all installation options</a>
    
      <div class="arch-select hidden">
        <select id="install-arch-select">
          <option disabled="true" selected="true" value=""></option>
          
            <option value="x86_64-unknown-linux-gnu">Linux x64</option>
          
            <option value="aarch64-apple-darwin">macOS Apple Silicon</option>
          
            <option value="x86_64-apple-darwin">macOS Intel</option>
          
            <option value="x86_64-pc-windows-msvc">Windows x64</option>
          
        </select>
      </div>
    
  </div>
</div>

<a href="/kdl-script/artifacts/" class="button mobile-download primary">View all installation options</a>


    <h1>kdl-script</h1>
<p><a href="https://crates.io/crates/kdl-script" rel="noopener noreferrer"><img src="https://img.shields.io/crates/v/kdl-script.svg" alt="crates.io"></a> <a href="https://docs.rs/kdl-script" rel="noopener noreferrer"><img src="https://docs.rs/kdl-script/badge.svg" alt="docs"></a> <img src="https://github.com/Gankra/kdl-script/workflows/Rust%20CI/badge.svg?branch=main" alt="Rust CI"></p>
<p>A Compiler for KDLScript, the <a href="https://kdl.dev/" rel="noopener noreferrer">KDL</a>-based programming language!</p>
<p>KDLScript is a "fake" scripting language that actually just exists to declare
type/function definitions in a language-agnostic way to avoid getting muddled
in the details of each language when trying to talk about All Languages In Reality.
It exists to be used by <a href="https://github.com/Gankra/abi-cafe" rel="noopener noreferrer">abi-cafe</a>.</p>
<p>Ultimately the syntax and concepts are heavily borrowed from Rust, for a few reasons:</p>
<ul>
<li>The author is very comfortable with Rust</li>
<li>This (and <a href="https://github.com/Gankra/abi-cafe" rel="noopener noreferrer">abi-cafe</a>) were originally created to find bugs in rustc</li>
<li>Rust is genuinely just a solid language for expressing ABIs! (Better than C/C++)</li>
</ul>
<p>The ultimate goal of this is to test that languages can properly communicate over
FFI by declaring the types/interface once and generating the Rust/C/C++/... versions
of the program (both caller and callee) and then linking them into various combinations
like "Rust Calls C++" to check that the values are passed correctly.</p>
<p>Since C is the lingua-franca of FFI, it's assumed that when lowering definitions
to the target language that they should be the "C Compatible" equivalent. For instance,
"u32" is intended to be your language's equivalent of "uint32_t".</p>
<p>In Rust this means all type definitions are implicitly <code>#[repr(C)]</code> (ideally should be
opt-outable). Most details about the function are left abstract so that <a href="https://github.com/Gankra/abi-cafe" rel="noopener noreferrer">abi-cafe</a>
can choose how to fill those in.</p>
<p>"C Compatible" gets fuzzier for some things like tagged unions.
Just uh... don't worry about it (see "Concepts" below for details).</p>
<h1>Usage</h1>
<p>kdl-script is both a library and a CLI application.</p>
<p>The main entry point to the library is [<code>Compiler::compile_path</code>][] or [<code>Compiler::compile_string</code>][],
which will produce a [<code>TypedProgram</code>][]. See the [<code>types</code>][] module docs for how to use that.</p>
<p>The CLI application can be invoked as <code>kdl-script path/to/program.kdl</code> to run a KDLScript program.</p>
<p>TODO: Write some examples! (See the <code>examples</code> dir for some.)</p>
<h1>Concepts</h1>
<p>A KdlScript program is a single file that has types, functions, and attributes (<code>@</code>) on those functions.</p>
<h2>Types</h2>
<p>The following kinds of types exist in KDLScript.</p>
<h3>Nominal Types</h3>
<p>A KDLScript user is allowed to declare the following kinds of nominal types</p>
<ul>
<li><code>struct</code> - a plain ol' struct</li>
<li><code>enum</code> - a c-style enum</li>
<li><code>union</code> - an untagged union</li>
<li><code>tagged</code> - a tagged union (rust-style enum)</li>
<li><code>alias</code> - a transparent type alias</li>
<li><code>pun</code> - a pun across the FFI boundary, "CSS for ifdefs"</li>
</ul>
<p><code>struct</code>, <code>enum</code>, <code>union</code>, and <code>alias</code> are hopefully pretty self-explanatory and uncontroversial as they have immediate C/C++ equivalents, so we'll speed through them quickly. <code>tagged</code> and <code>pun</code> merit deeper discussion.</p>
<h4>Struct Types</h4>
<p>Just what you expect!</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">struct "Point" {
</span><span style="color:#eeffff;">    x "f32"
</span><span style="color:#eeffff;">    y "f32"
</span><span style="color:#eeffff;">}
</span></pre>

<p>Field names may be marked "positional" by giving them the name <code>_</code>. If all fields are positional then languages like Rust should emit a "tuple struct". So this:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">struct "Point" {
</span><span style="color:#eeffff;">    _ "f64"
</span><span style="color:#eeffff;">    _ "f64"
</span><span style="color:#eeffff;">}
</span></pre>

<p>would be emitted as this Rust:</p>
<pre style="background-color:#263238;"><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">repr</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">C</span><span style="color:#89ddff;">)]
</span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">Point</span><span style="color:#89ddff;">(</span><span style="font-style:italic;color:#c792ea;">f64</span><span style="color:#eeffff;">, </span><span style="font-style:italic;color:#c792ea;">f64</span><span style="color:#89ddff;">);
</span></pre>

<p>Otherwise positional names will get autonamed something like <code>field0</code>, <code>field1</code>, etc.</p>
<h4>Enum Types</h4>
<p>Just what you expect!</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">enum "IOError" {
</span><span style="color:#eeffff;">    FileNotFound 2
</span><span style="color:#eeffff;">    FileClosed
</span><span style="color:#eeffff;">    FightMe 4
</span><span style="color:#eeffff;">}
</span></pre>

<p>The optional integer values specify what value that variant should "have" in its underlying integer repr. Otherwise variants start at 0(?) and auto-increment.</p>
<p>Just like struct fields, enum variants can have "positional" naming with <code>_</code> which will get autonaming like <code>Case0</code>, <code>Case1</code>, etc.</p>
<p>TODO: is it ok to have multiple variants with the same value? Whose responsibility is it to bounds check them to the underlying type, especially in the default case where it's "probably" a fuzzy <code>c_int</code>?</p>
<p>TODO: add an attribute for specifying the underlying integer type. (<code>@tag</code>?)</p>
<h4>Union Types</h4>
<p>Just what you expect!</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">union "FloatOrInt" {
</span><span style="color:#eeffff;">    Float "f32"
</span><span style="color:#eeffff;">    Int "u32"
</span><span style="color:#eeffff;">}
</span></pre>

<p>Just like struct fields, union variants can have "positional" naming with <code>_</code> which will get autonaming like <code>Case0</code>, <code>Case1</code>, etc.</p>
<p>TODO: should we allow inline struct decls like C/C++ does, or require the user to define the structs separately?</p>
<h4>Alias Types</h4>
<p>Just what you expect!</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">alias "MetersU32" "u32"
</span></pre>

<p>Note that the ordering matches Rust <code>type Alias = RealType;</code> syntax and not C/C++'s backwards-ass typedef syntax.</p>
<p>See Pun Types for additional notes on how aliases interact with typeids!</p>
<h4>Tagged Types</h4>
<p>Tagged is the equivalent of Rust's <code>enum</code>, a tagged union where variants have fields, which has no "obvious" C/C++ analog.
Variant bodies may either be missing (indicating no payload) or have the syntax of a <code>struct</code> body.</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">tagged "MyOptionU32" {
</span><span style="color:#eeffff;">    None
</span><span style="color:#eeffff;">    Some { _ "u32"; }
</span><span style="color:#eeffff;">    FileNotFound { 
</span><span style="color:#eeffff;">        path "[u8; 100]"
</span><span style="color:#eeffff;">        error_code "i64"
</span><span style="color:#eeffff;">    }
</span><span style="color:#eeffff;">}
</span></pre>

<p>However, <a href="https://github.com/rust-lang/rfcs/blob/master/text/2195-really-tagged-unions.md" rel="noopener noreferrer">Rust RFC 2195 - "Really Tagged Unions"</a> specifies the C/C++ equivalent layout/ABI for these types when <code>repr(C)</code> and/or <code>repr(u8)</code> is applied to one. <a href="https://github.com/eqrion/cbindgen" rel="noopener noreferrer">cbindgen</a> implements this conversion. By default the <code>repr(C)</code> layout is to be used (how to select others is TBD).</p>
<p>A quick TL;DR of the RFC:</p>
<p>The <code>repr(C)</code> layout is the <em>most</em> obvious lowering to a <code>struct</code> containing a c-style <code>enum</code> and a <code>union</code>. The <code>enum</code> says which case of the union is currently valid.</p>
<p>The <code>repr(u8)</code> layout (also <code>repr(u32)</code>, etc.) is similar but the <code>enum</code> specifically has that integer type, and instead of being stored in a wrapper struct it's stored as the first field of every variant of the <code>union</code>. This is a more compact layout because space doesn't need to be wasted for padding between the <code>enum</code> and the <code>union</code>. Also it's more reliable because C refuses to specify what the backing integer of a normal enum <em>is</em> so rustc just guesses based on the platform.</p>
<p>TODO: should payload-less variants allow for integer values like <code>enum</code> variants do?</p>
<p>TODO: figure out how exactly to specify you really want <code>repr(rust)</code> or <code>repr(u8)</code> or <code>repr(C, u8)</code> layouts.</p>
<p>TODO: if we ever add support for Swift or whatever there will need to be A Reckoning because it has its own ABI/layouts for enums that are way more complex and guaranteed for more complicated cases! For now, we punt!</p>
<h4>Pun Types</h4>
<p>A pun is the equivalent of an ifdef'd type, allowing us to declare that two wildly different declarations in different languages should in fact have the same layout and/or ABI. A pun type contains "selector blocks" which are sequentially matched on much like CSS. The first one to match wins. When lowering to a specific backend/config if no selector matches, then compilation fails.</p>
<p>Here is an example that claims that a Rust <code>repr(transparent)</code> newtype of a <code>u32</code> should match the ABI of a <code>uint32_t</code> in C/C++:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">pun "MetersU32" {
</span><span style="color:#eeffff;">    lang "rust" {        
</span><span style="color:#eeffff;">        @ "#[repr(transparent)]"
</span><span style="color:#eeffff;">        struct "MetersU32" {
</span><span style="color:#eeffff;">            a "u32"
</span><span style="color:#eeffff;">        }
</span><span style="color:#eeffff;">    }
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    lang "c" "cpp" {
</span><span style="color:#eeffff;">        alias "MetersU32" "u32"
</span><span style="color:#eeffff;">    }
</span><span style="color:#eeffff;">}
</span></pre>

<p>Because of this design, the typechecker does not "desugar" <code>pun</code> types to their underlying type when computing type ids. This means <code>[MetersU32; 4]</code> will not be considered the same type as <code>[u32; 4]</code>... because it's not! This is fine because type equality is just an optimization for our transpiler usecase. Typeids mostly exist to deal with type name resolution.</p>
<p>Pun resolving is done as a second step when lowering the abstract <code>TypedProgram</code> to a more backend-concrete <code>DefinitionGraph</code>.</p>
<p>(<code>alias</code> also isn't desugarred and has the same "problem" but this is less "fundamental" and more "I want the backend to actually emit
a type alias and use the alias", just like the source KDLScript program says!)</p>
<p>The currently supported selector blocks are:</p>
<ul>
<li><code>lang "lang1" "lang2" ...</code> - matches <em>any</em> of the languages</li>
<li><code>default</code> - always matches</li>
</ul>
<p>Potentially Supported In The Future:</p>
<ul>
<li><code>compiler "compiler1" "compiler2" ...</code></li>
<li><code>cpu</code> ...</li>
<li><code>os</code> ...</li>
<li><code>triple</code> ...</li>
<li><code>any { selector1; selector2; }</code></li>
<li><code>all { selector1; selector2; }</code></li>
<li><code>not { selector; }</code></li>
</ul>
<p>TODO: should we allow pun blocks to have other types defined in the block that are "private" from the rest of the program but used in the final type?</p>
<p>TODO: figure out how to talk about "language-native types" in much the same way the above example uses "language-native annotations".</p>
<h3>Structural Types</h3>
<p>A KDLScript user is allowed to use the following kinds of structural types</p>
<ul>
<li><code>&amp;T</code> - a transparent reference to T</li>
<li><code>[T; N]</code> - a fixed-length array of T (length N)</li>
<li><code>()</code> - the empty tuple (I just like adding this cuz it's cute!!!)</li>
</ul>
<p>TODO: figure out if we want to bake in Rust's <code>Option</code> type here, if only for <code>Option&lt;&amp;T&gt;</code>.</p>
<p>TODO: figure out if there's any point in non-empty tuples</p>
<h4>Reference Types</h4>
<p>The "value" of a reference type <code>&amp;T</code> is its pointee for the purposes of <a href="https://github.com/Gankra/abi-cafe" rel="noopener noreferrer">abi-cafe</a>. In this regard it's similar to C++ references or Rust references, where most operations automagically talk about the pointee and not the pointer. Using a reference type lets you test that something can properly be passed-by-reference, as opposed to passed-by-value.</p>
<p>Reference types may appear in other composite types, indicating that the caller is responsible for allocating variables for each one and then storing pointers to them in the composite type.</p>
<p>When used in the outputs of a function, a reference type is sugar for an out-param that the caller is responsible for allocating
and the callee is responsible for initializing. Out-params should appear after all normal inputs but before varargs.</p>
<p>TODO: think through if the caller has any need to initialize an out-param (Currently irrelevant as we only suppport POD)</p>
<p>TODO: think through what it means to have an out-param of <code>[&amp;u32; 4]</code>! (We should conservatively reject it for now.)</p>
<h4>Array Types</h4>
<p>Array types like <code>[u32; 4]</code> have the layout/repr you would expect from languages like C and Rust, but there's a problem with passing them by-value: C is supremely fucking weird about passing arrays by value if they're not wrapped in a struct.</p>
<p>This is actually sugar for pass-by-reference (and largely decays into <code>u32*</code>):</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">void </span><span style="color:#82aaff;">blah</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">u32</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">4</span><span style="color:#89ddff;">] </span><span style="color:#f78c6c;">array</span><span style="color:#89ddff;">);
</span></pre>

<p>And this doesn't even compile:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">u32</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">4</span><span style="color:#89ddff;">] </span><span style="color:#82aaff;">blah</span><span style="color:#89ddff;">();
</span></pre>

<p>To avoid trying to squish weird square pegs in round holes, passing an array by-value like this in KDLScript should indeed mean passing it by-value! C/C++ backends should <em>simply refuse to lower such a KDLScript program and produce an error</em>. Rust backends are free to lower it in the obvious way. If you want to test the C way, use this:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">fn "blah" {
</span><span style="color:#eeffff;">    inputs { _ "&amp;[u32; 4]"; }
</span><span style="color:#eeffff;">}
</span></pre>

<p><strong>NOT THIS</strong>:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">fn "blah" {
</span><span style="color:#eeffff;">    inputs { _ "[u32; 4]"; }
</span><span style="color:#eeffff;">}
</span></pre>

<p>TODO: does anything special need to be said about empty arrays? Or do backends just YOLO the obvious lowering? (yes?)</p>
<h3>Primitives</h3>
<p>There are various builtin primitives, such as:</p>
<ul>
<li>integers (i8, u128, ...)</li>
<li>floats (f16, f32, f64, f128, ...)</li>
<li><code>bool</code>- your old pal the boolean (TriBool support TBD)</li>
<li><code>ptr</code> - an opaque pointer (<code>void*</code>), used when you're interested in the value of the pointer and not its pointee (unlike <code>&amp;T</code>)</li>
</ul>
<p>In the future there will probably be language-specific primitives like <code>c_long</code>.</p>
<p>TODO: figure out if <code>ptr</code> should be nullable or not by default. Relevant to whether we want to have Option and if Rust code should lower it to <code>*mut ()</code>.</p>
<h2>Functions</h2>
<p>Functions are where the Actually Useful <em>library</em> version of KDLScript and the Just A Meme <em>application</em> version of KDLScript diverge. This difference is configured by the <code>eval</code> feature.</p>
<p>In library form KDLScript only has function <em>signature declarations</em>, and it's the responsibility of the <a href="https://github.com/Gankra/abi-cafe" rel="noopener noreferrer">abi-cafe</a> backend using KDLScript to figure out what the body should be. In binary form you can actually fill in the body with some hot garbage I hacked up.</p>
<p>For now we'll only document declaration.</p>
<p>Here is a fairly complicated/contrived example function:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">fn "my_func" {
</span><span style="color:#eeffff;">    inputs {
</span><span style="color:#eeffff;">        x "u32"
</span><span style="color:#eeffff;">        y "[&amp;MyType; 3]"
</span><span style="color:#eeffff;">        _ "&amp;bool"
</span><span style="color:#eeffff;">    }
</span><span style="color:#eeffff;">    outputs {
</span><span style="color:#eeffff;">        _ "bool"
</span><span style="color:#eeffff;">        _ "&amp;ErrorCode"
</span><span style="color:#eeffff;">    }
</span><span style="color:#eeffff;">}
</span></pre>

<p>Functions can have arbitrarily many inputs and outputs with either named or "positional" names (which will get autonaming like <code>arg0</code>, <code>arg1</code> and <code>out0</code>, <code>out1</code>, etc.).</p>
<p>As discussed in the section on "Reference Types", references in outputs are sugar for out-params, which should appear after the inputs and before outputs. So the above would lower to something like the following in Rust (values chosen arbitrarily here, and we wouldn't use asserts in practice, but instead record the values for comparison):</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">my_func</span><span style="color:#89ddff;">(
</span><span style="color:#eeffff;">    </span><span style="color:#f78c6c;">x</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u32</span><span style="color:#eeffff;">,
</span><span style="color:#eeffff;">    </span><span style="color:#f78c6c;">y</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> [</span><span style="color:#89ddff;">&amp;</span><span style="color:#eeffff;">MyType; 3],
</span><span style="color:#eeffff;">    </span><span style="color:#f78c6c;">arg2</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">bool</span><span style="color:#eeffff;">,
</span><span style="color:#eeffff;">    </span><span style="color:#f78c6c;">out1</span><span style="color:#89ddff;">: &amp;</span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> ErrorCode,
</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">bool </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// Check the inputs are what we expect...
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">x</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">5</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">y</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">]</span><span style="color:#eeffff;">.val</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">8</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">y</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">]</span><span style="color:#eeffff;">.val</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">9</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">y</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">2</span><span style="color:#89ddff;">]</span><span style="color:#eeffff;">.val</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(*</span><span style="color:#eeffff;">arg2</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">true</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// Return outputs
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">*</span><span style="color:#eeffff;">out1 </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">ErrorCode</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Bad</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">return </span><span style="color:#f78c6c;">true</span><span style="color:#89ddff;">;
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">my_func_caller</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// Setup the inputs
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> x </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">5</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> y_0 </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> MyType </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> val</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">8 </span><span style="color:#89ddff;">};
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> y_1 </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> MyType </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> val</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">9 </span><span style="color:#89ddff;">};
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> y_2 </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> MyType </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> val</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">10 </span><span style="color:#89ddff;">};
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> y </span><span style="color:#89ddff;">= [&amp;</span><span style="color:#eeffff;">y_0</span><span style="color:#89ddff;">, &amp;</span><span style="color:#eeffff;">y_1</span><span style="color:#89ddff;">, &amp;</span><span style="color:#eeffff;">y_1</span><span style="color:#89ddff;">];
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> arg2 </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">false</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// Setup outparams
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> out1 </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">ErrorCode</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">default</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">    
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// Do the call
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> out0 </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">my_func</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">x</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> y</span><span style="color:#89ddff;">, &amp;</span><span style="color:#eeffff;">arg2</span><span style="color:#89ddff;">, &amp;</span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> out1</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// Checkout outputs
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">out0</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">true</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(*</span><span style="color:#eeffff;">out1</span><span style="color:#89ddff;">, </span><span style="color:#eeffff;">ErrorCode</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Bad</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span></pre>

<blockquote>
<p>God writing that sucked ass, and it wasn't even the "proper" value checking! This is why I built all this complicated crap to automate it!</p>
</blockquote>
<p>TODO: what does it mean if you have multiple non-out-param outputs? Return a tuple? Error out on all known backends?</p>
<p>TODO: contemplate if named args should be the equivalent of Swift named args, where the inner and outer name can vary, but the outer name is like, part of the function name itself (and/or ABI)?</p>
<p>TODO: contemplate varargs support</p>
<p>Strawman varargs syntax for saying there's varargs but that you want to test this particular set of values passed in them:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">func "blah" {
</span><span style="color:#eeffff;">    inputs {
</span><span style="color:#eeffff;">        x "u32"
</span><span style="color:#eeffff;">        "..." {
</span><span style="color:#eeffff;">            _ "f32"
</span><span style="color:#eeffff;">            _ "f32"
</span><span style="color:#eeffff;">        }
</span><span style="color:#eeffff;">    }
</span><span style="color:#eeffff;">}
</span></pre>

<p>SUB TODO: figure out if varargs should allow for specifying what the callee and caller think is happening as different</p>
<p>SUB TODO: figure out if we should try to support that fucked up thing where Swift supports multiple named varargs lists</p>
<h2>Attributes</h2>
<p>Attributes start with <code>@</code> and apply to the next item (function or type) that follows them. This is only kinda stubbed out and not really impl'd.</p>
<p>TODO: add attributes:</p>
<ul>
<li><code>@ "whatever you want here"</code> - passthrough attrs to underlying language</li>
<li><code>@tag "u32"</code> - setting the backing type on an <code>enum</code>'s tag</li>
<li><code>@packed N?</code> - making a type packed</li>
<li><code>@align N</code> - making a type aligned</li>
</ul>
<p>TODO: should fields/args be able to have attributes?</p>
<p>TODO: at what level should attributes be validated/processed? The parser? Type checker? Backends?</p>
<h1>Demo</h1>
<p>The evaluator has not at all kept up with the type system, so it can only handle some really simply stuff.
You can run the <code>examples/simple.kdl</code>. All the other examples will just dump type information and decl order
as they don't define <code>main</code>.</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">&gt; cargo run examples/simple.kdl
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">{
</span><span style="color:#eeffff;">  y: 22
</span><span style="color:#eeffff;">  x: 11
</span><span style="color:#eeffff;">}
</span><span style="color:#eeffff;">33
</span></pre>

<p>Is executing the following kdl document:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">@derive "Display"
</span><span style="color:#eeffff;">struct "Point" {
</span><span style="color:#eeffff;">    x "f64"
</span><span style="color:#eeffff;">    y "f64"
</span><span style="color:#eeffff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">fn "main" {
</span><span style="color:#eeffff;">    outputs { _ "f64"; }
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    let "pt1" "Point" {
</span><span style="color:#eeffff;">        x 1.0
</span><span style="color:#eeffff;">        y 2.0
</span><span style="color:#eeffff;">    }
</span><span style="color:#eeffff;">    let "pt2" "Point" {
</span><span style="color:#eeffff;">        x 10.0
</span><span style="color:#eeffff;">        y 20.0
</span><span style="color:#eeffff;">    }
</span><span style="color:#eeffff;">    
</span><span style="color:#eeffff;">    let "sum" "add:" "pt1" "pt2"
</span><span style="color:#eeffff;">    print "sum"
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    return "+:" "sum.x" "sum.y"
</span><span style="color:#eeffff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">fn "add" {
</span><span style="color:#eeffff;">    inputs { a "Point"; b "Point"; }
</span><span style="color:#eeffff;">    outputs { _ "Point"; }
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    return "Point" {
</span><span style="color:#eeffff;">        x "+:" "a.x" "b.x"
</span><span style="color:#eeffff;">        y "+:" "a.y" "b.y"
</span><span style="color:#eeffff;">    }
</span><span style="color:#eeffff;">}
</span></pre>

<h1>Why Did You Make KDL Documents Executable???</h1>
<p>To spite parsers.</p>
<p>Ok more seriously because I needed something like this for <a href="https://github.com/Gankra/abi-cafe" rel="noopener noreferrer">abi-cafe</a> but it's a ton of work so I'm self-motivating by wrapping it in the guise of a scripting language because it's funny and I can make more incremental progress, as I have a lot to implement before it's usable in the thing it's built for.</p>



        </main>
      </div>

      <footer>
        
          <a href="https://github.com/Gankra/kdl-script"><div class="github-icon" aria-hidden="true"></div></a>
        
        <span>
          kdl-script, MIT OR Apache-2.0
        </span>
      </footer>
    </div>

    
    

    

    <script src="/kdl-script/artifacts.js"></script>


  </body>
</html>